



Die grundlegende Idee bestand darin eine Frequenzanalyse mit Wavelets zu machen. Diese kann dann verwendet werden um die Signale nach belieben zu manipulieren und nach wünschen anzupassen. Die Multiskalenanalyse bietet einen schnellen Rechenalgorhytmus jedoch ist er darauf konzipiert keine redundate Daten zu erzeugen. Durch das prinzip der Frequenzhalbierung, die auf jedem sogenannten Level einer Multiskalenanalyse passiert, sieht man nur alle Oktaven eines Signales. So können Frequenzen die nahe bei einander liegen nicht von einander unterschieden werden. Dafür lässt sich das ursprüngliche Signal nach einer msa wieder verlustfrei rekonstruieren. 

\subsection{Framing}
Die normale msa besitzt nur Orthonormierte Basen weshalb sie auch keine redundante Daten besitzt. Zur analyse zwecken würde es sich lohnen mehr von diesen Basen zu erzeugen und die enstehung der zusätzlichen Informationen zu verwenden. Wenn wir nun mehr von diesen Basen hinzufügen erschaffen wir ein überbestimmtes System welches ab hier Frame genannt wird. Genauere abhandlungen über Frames ist im Kapitel\ref{chapter:geometrie} unter \ref{subsetion:skript:frames:framesinrn} zu finden. Um ein Frame sinnvoll zu gestalten werden die zusätzlichen Basen auch im Zweierlogharitmus gestaltet. Um nun alle zwölf Halbtöne eines eines Signales detektieren zu können werden mindestens zwölf Basen benötigt. Um ein Sampling herzustellen wird als Grundbasis der Beginn einer Oktave verwendet. Da die Samplingfrequenz mindestens doppelt so schnell sein muss wie die zu Analysierende Frequenz kann als Oktavenbasis ein vielfaches von $220[Hz]$ verwendet werden. Sinnvollerweise auch im zweierlogarhytmus. Das mp3 Format kann eine maximale Tonfrequenz von $16k[Hz]$ wiedergeben. Dem entsprechend ist für Musik eine Maximale Samplingfrequenz von $32k[Hz]$ sinvoll. In der Theorie spielt es jedoch keine Rolle in welchen Frequenzband das Sampling geschieht solange $\frac{f_{Sampling}}{f_{Signal}}\geq2$ gegeben ist. Mit der folgenden Gleichung wurden die verschiednen Samplingfrequenzen bestimmt welche dann verwendet wurden um die Signale neu zu Samplen. 
\begin{equation}
fs_{n}=f\cdot2^{\frac{n}{k}}
\end{equation}
$k$ steht dabei für die Anzahl Basen die man in einer Oktave haben möchte. Sinnvollerweise wird $k \geq 12$ gewählt.\\

Hierzu ein praktisches Beispiel zu den Sampelfrequenzen. Folgende Werte werden gegeben:
\begin{itemize}
	\item Samplefrequenz $f=440$\text{[Hz]}
	\item Anzahl Basen $k=12$
\end{itemize}	

\[
fs
=
 \begin{pmatrix}
fs_{0}\\
fs_{1}\\
fs_{2}\\
fs_{3}\\
fs_{4}\\
fs_{5}\\
fs_{6}\\
fs_{7}\\
fs_{8}\\
fs_{9}\\
fs_{10}\\
fs_{11}\\
\end{pmatrix}
=
\begin{pmatrix}
440\cdot2^{\frac{0}{12}}\\
440\cdot2^{\frac{1}{12}}\\
440\cdot2^{\frac{2}{12}}\\
440\cdot2^{\frac{3}{12}}\\
440\cdot2^{\frac{4}{12}}\\
440\cdot2^{\frac{5}{12}}\\
440\cdot2^{\frac{6}{12}}\\
440\cdot2^{\frac{7}{12}}\\
440\cdot2^{\frac{8}{12}}\\
440\cdot2^{\frac{9}{12}}\\
440\cdot2^{\frac{10}{12}}\\
440\cdot2^{\frac{11}{12}}\\
\end{pmatrix}
 \text{[Hz]}
 \approx
 \begin{pmatrix}
 440\\
466.164\\
493.883\\
523.251\\
554.365\\
587.330\\
622.254\\
659.255\\
698.456\\
739.989\\
783.991\\
830.609\\
 \end{pmatrix}
 \text{[Hz]} 
\]
In dem Vektor $fs$ sind die Sampelfrequenzen vorhanden mit welchen die dazughörigen Sampelintervalle berechnet werden. Um die  Signallänge von der Sampling Frequenz zu entkoppeln werden die Elemente von $fs$ als auf Samples pro Sekunde normiert. $fs$ mus nun immer mit der Signaldauer multiliziert werden um die richtige Menge an Samples zu erhalten.\\

Das Ziel ist es ein Frame zu erstellen, dessen Zeilen aus dem verschieden Gesampleten Signal besteht. Die Signaldauer $T_{s}$ wird dabei mit der Anzahl Samples pro Sekunde Multipliert um damit den Kehrwert der Zeit $T$ zweischen den Samples zu erlangen.
\[T_{i}=\frac{1}{fs_{n}\cdot T_{s}}\]
Der Index $T_{i}\in[t_{0},t_{1},...,t_{k}]$ steht dabei für alle Diskrete Zeitwerte die für ein Sampling mit den $k$ Basen verwendet werden.
\[
\mathcal{T}
=
\begin{pmatrix}
\vdots\\
\sum_{n=-\infty}^{+\infty} \delta(t - nt_{i+1})\\
\sum_{n=-\infty}^{+\infty} \delta(t - nt_{i+2})\\
\sum_{n=-\infty}^{+\infty} \delta(t - nt_{i+3})\\
\vdots\\
\end{pmatrix}
\cdot x(t)
\]
Auf dieses Frame wird dann eine Multiskalenanalyse angwendet. In dem Frame gibt es verschieden viele abgetastete Werte in den einzelnen Zeilen da $T_{i}$ durch die höheren Frequenzen quantitative mehr Elemente dazubekommt. Die wenigsten Elemente findet man dabei in der ersten Zeile des Frames. Diese wird verwendet um die Anzahl Levels der msa zu bestimmen. 
\[level = \left\lfloor\log_2\left(\mathtt{
	\frac{\mathcal{T}\_\text{min\_len}}{\text{filter\_len -1}}}\right)\right\rfloor
\]
Mit Level0 wird dabei auf das oberste Level referenziert welches die kleinste Frequenzteiung erfährt. Die Levels laufen also reziprok zu den Basen welche von unten nach oben benannt sind. Um dies besser zu Ilustrieren sind die Anzahl und Positionen in dem Bild \ref{fig:frame_konst} konzeptionell abgebildet. Man ging dabei von der Ursprungsbasis von 55 Samples aus. Es wurde dann mit sechs unterteilungen also $k=6$ ein Frame gebaut welches dann über vier Levels dargstellt ist. In der Grafik \ref{fig:frame_konst} ist die Struktur der einzelnen Vektoren, deren Anzahl von Datenpunkten sowie derigen verschiebung gut ersichtlich. \\
  
Das Resultat der msa liefert uns $k\cdot \text{Anz. Level}$ Vektoren zurück welche alle eine unterschiedliche Länge besitzen. Um sie sinnvoll zu Sortieren beginnt man mit der Tiefsten Basis auf dem höchsten Level. Die gleichwertigen Level werden dann übereinander gestapelt von der kleinsten Basis zur grössten. Dann kommt das nächste Level. Mit dieser Struktur hat man die besten Resultate ohne eingriffe in die eigentlichen Werte vorzunehmen. 


\begin{figure}[h]
	\centering
	\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/msa/msa.pdf}
	\caption{Frame-Multiskalenanalyse mit 6 Basen und 4 Level gezeigt}\label{fig:frame_konst}
\end{figure}%

Die gleiche Methodik wie in Grafik \ref{fig:frame_konst} wurde für die anschliessenden Frame-Multiskalenanalysen verwendet.


\subsection{Analyse mit Frames}
In diesem Unterkapitel wird beschrieben welchen ablauf gewählt wurde um eine Analyse eines Testsignales durchzuführen.\\
Zuerst wurde ein Testsignal $x(t)$ erstellt. In der Grafik \ref{fig:frame-testsig} ist $x(t)$ abgebildet. Das Signal $x(t)$ besteht aus fünf verschiedenen Sinusschwingungen die aneinander gekoppelt wurden. Dazu eine kurze Beschreibung welche Frequenzen im dem Signal erhalten sind:\\
Die ersten zwei Ausschwenker schwingen über die dauer von jeweils $100$\text{ms}, mit der Frequenz 110 \text{[Hz]}. \\
Der dritte Ausschwenker schwingt $100$\text{[ms]} mit $220\cdot 2^{\frac{1}{12}}$\text{[Hz]}, folgend auf einen $100$\text{[ms]} Ausschwenker mit einer Frequenz von $220\cdot 2^{\frac{2}{12}}$ \text{[Hz]}. \\
Der letzte Block beginnt mit $220\cdot 2^{\frac{2}{12}}$\text{[Hz]} über eine dauer von $100$\text{[ms]} bis die Amplitude $a=1$ erreicht ist. Danach wechselt das Signal fliessend auf $220\cdot 2^{\frac{5}{12}}$\text{[Hz]} für $100$\text{[ms]} und endet mit $220\cdot 2^{\frac{6}{12}}$\text{[Hz]}. Die gesamte Signaldauer ist genau eine Sekunde lang. \\



In der Grafik \ref{fig:Frame-Analyse} wird eine Frame-msa und eine cwt-Analyse des gleichen Testsignales\ref{fig:frame-testsig} nebeneinander gestellt. Die Frame-msa wird dabei nur im Absolutwert dargestellt da so die Resultate noch eindeutiger sind. Im vergleich können nun die Unterschiede erkannt werden. Die Frame-msa hat deutliche Peak- und Nullstellen an Orten wo die cwt keine solche schwankungen aufweist. 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.9\linewidth]{papers/autotune/sections/frames/images/testsig.jpg}
	\captionof{figure}{Testsignal}\label{fig:frame-testsig}
	\begin{tabularx}{\columnwidth}{XX}
		\includegraphics[width=1.3\linewidth]{papers/autotune/sections/frames/images/cwt.jpg}
		\captionof{figure}{Cwt Analyse mit komplexem Gauss Wavelet des Testsignal}\label{fig:stft256}
		&   \includegraphics[width=1.3\linewidth]{papers/autotune/sections/frames/images/12dwt.jpg}   
		\captionof{figure}{Dauberchi 8 Frame Analyse des Testsignal}\label{fig:cwtsweep}         
	\end{tabularx}
	\caption{Vergleich der Absolutwerte von der cwt und der Frame Analyse mit 12 Basen}
	\label{fig:Frame-Analyse}
\end{figure}%



\begin{figure}[!ht]
	\begin{minipage}{.5\linewidth}
		\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/1dwt.jpg}
		\caption{Frame-msa mit 1 Basis}
	\end{minipage}%

	
	\begin{minipage}{.5\linewidth}
	\centering
	\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/4dwt.jpg}
	\caption{Frame-msa mit 4 Basen}
	\end{minipage}

	\begin{minipage}{.5\linewidth}
	\centering
	\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/12dwt.jpg}
	\caption{Frame-msa mit 12 Basen}
	\end{minipage}
	
	\begin{minipage}{.5\linewidth}
		\centering
		\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/24dwt.jpg}
		\caption{Frame-msa mit 24 Basen}
	\end{minipage}

	
	\caption{Verschiedene Fensterfunktionen und deren Beschreibung}\cite{wikipedia:Window}
	\label{fig:STFTtab}
\end{figure}


Von diesen Analyseresultaten sollen nun auch die Frequenzen extrahiert werden. Dabei macht man sich die Lokalen maximas der Matrix zunutze. Man vergleicht in der Matrix selber die jeweiligen nachbar Werte ob der Wert grösser oder kleiner ist. Von den Lokalen maximas werden die Koordinaten gesammelt welche dann mit den Level verglichen werden kann und so die Frequenz gefunden.\\
Um eine gute Qualität von Peak zu erhalten wurde noch ein Maximum Filter auf die Matrix angewendet. Dieser ersetzt in dem vordefinierten radius $r$ die Werte einer Matrix mit den Lokal gefundenen Maximalwert. Das Ziel des Maximum Filters ist die elimination der Nullstellen die direkt in den wichtigen Signalverläufen vorkommen. Durch dieser Maximal Filter werden jedoch auch Resultate verfälscht, was in den Versuchen gerade im Frequenzbereich sichtbar wurde. Dieser ist mit der relativ beschränkten Ahnzahl Level und Basen, viel empfindlicher auf Störungen, als die sehr fein aufgelöste Zeitachse. \\
In der Folgenden Grafik\ref{fig:cwt_max} wurde das genannte Ferfahren um Maximalstellen zu finden an der cwt Analyse angewendet. Diese kann somit als Referenz dienen. 

\begin{figure}[!ht]
	\centering
	\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/cwtmaxima.jpg}
	\captionof{figure}{Maxima berechnung  des cwt}\label{fig:cwt_max}
\end{figure}%
In der cwt Grafik sieht man schön wie stabil die Frequenzen in der jeweils konstanten Frequenz angezeigt wird. Auch wenn man das Ergebnis der Koordinaten zurück rechnet kommt man auf die richtigen Frequenzen. Sprünge, Anfangswerte und jegliche andere Unstetigkeit der Funktion verzeiht auch die Ergebnisse der cwt.
\\
Die nächste Grafik \ref{fig:msa_max} bildet die Frame-msa ab, welche nach der fleichen Art wie \ref{fig:cwt_max} Analysiert wurde. Man bekommt die Frequenz nicht 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=\linewidth]{papers/autotune/sections/frames/images/dwtmaxima.jpg}
	\captionof{figure}{Maxima berechnung  der Frame-msa}\label{fig:msa_max}
\end{figure}%


